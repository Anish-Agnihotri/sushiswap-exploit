# sushiswap-exploit

SushiSwap [RouteProcessor2](https://etherscan.io/address/0x044b75f554b886a065b9567891e45c79542d7357#code) exploit reproduction + supporting data useful for whitehat rescue.

## Exploit reproduction

Found in [src/CounterExploit.sol](./src/CounterExploit.sol). Exploits pool re-entrancy to arbitrarily transfer approved tokens.

The [Tenderly debugger](https://dashboard.tenderly.co/tx/mainnet/0xea3480f1f1d1f0b32283f8f282ce16403fe22ede35c0b71a732193e56c5c45e8) is useful in understanding the exploit path.

```bash
# Get dependencies
forge update

# Run tests
forge test --fork-url MAINNET_RPC --fork-block-number 17007460
```

## Whitehat data

With the `RouteProcessor2` contract deployed across 14 chains, users are susceptible to allowance drainage across many networks. [./data](./data) contains code and allowance mappings used to generate and whitehat balances.

Note:

1. These allowances are only based on addresses that interacted with the RouteProcessor2 contract (and do not include allowances approved indepdently of a swap or other interaction), except for mainnet, where I bruteforced approvals in all blocks since the router was deployed.
2. Although I have whitehatted all possible non-zero balances _today_, there may exist more _in the future_, as users with non-zero approvals but zero balances add pre-approved tokens to their wallets.

## License

[GNU Affero GPL v3.0](https://github.com/Anish-Agnihotri/sushiswap-exploit/blob/master/LICENSE)
